---
layout: post
title: "Use ResourceDictionary to do multi-language in WPF"
date: 2013-11-06 12:00:00
comments: true
tags: [CSharp]
description: "Use ResourceDictionary to do multi-language in WPF"
---
<p>這篇稍稍紀錄一下怎樣在WPF中使用ResourceDictionary去做多語系程式。</p>  <p> </p>  <p>首先準備好要做多語系的程式，這邊筆者事先隨便開個WPF Window，在上面放個Label元件，裡面打入"Test"字樣。</p>  <p>   </p><div id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:99638646-f575-42f1-b0c8-1f5675ff1fd2" class="wlWriterSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre name="code" class="xml">&lt;Window x:Class="WpfApplication5.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MainWindow"
        Width="525"
        Height="350"&gt;
    &lt;Grid&gt;
        &lt;Label HorizontalAlignment="Center"
               VerticalAlignment="Center"
               Content="Test"
               FontSize="70" /&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;
</pre></div>


<p> </p>

<p><img style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px" border="0" alt="image" src="\images\posts\4066d006-7d5c-4080-9dd8-fbe285bc438d\image_thumb_1.png" width="529" height="354" /> </p>

<p> </p>

<p>要做多語系的程式準備好了後，我們要為專案加入ResourceDictionary去做多語，檔名這邊筆者是暫定為StringResources.xaml。裡面的XAML內容像下面這樣，加入System命名空間，然後在裡面設定String資源。</p>

<div id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:000d1acc-3ccb-4fcc-b114-4a0894ee147b" class="wlWriterSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre name="code" class="xml">ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:system="clr-namespace:System;assembly=mscorlib"&gt;
    &lt;system:String x:Key="TestString"&gt;Test&lt;/system:String&gt;
&lt;/ResourceDictionary&gt;</pre></div>

<p> </p>

<p>英文版的設定好後，在檔案總管將StringResources.xaml檔複製並改名為StringResource.zh-tw.xaml檔，且將裡面的String資源訂定的值翻譯成中文。像是下面這樣：</p>

<div id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:da757e07-a1a3-49be-bad5-d836d751799b" class="wlWriterSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre name="code" class="xml">&lt;ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:system="clr-namespace:System;assembly=mscorlib"&gt;
    &lt;system:String x:Key="TestString"&gt;測試&lt;/system:String&gt;
&lt;/ResourceDictionary&gt;</pre></div>

<p> </p>

<p>接著開啟App.xaml檔，將String.Resources.xaml加到MergedDictionaries。</p>

<div id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:3e93a8c6-35f0-4ff3-b8ae-870906a52033" class="wlWriterSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre name="code" class="xml">&lt;Application x:Class="WpfApplication5.App"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Startup="Application_Startup"
             StartupUri="MainWindow.xaml"&gt;
    &lt;Application.Resources&gt;
        &lt;ResourceDictionary&gt;
            &lt;ResourceDictionary.MergedDictionaries&gt;
                &lt;ResourceDictionary Source="StringResources.xaml" /&gt;
            &lt;/ResourceDictionary.MergedDictionaries&gt;
        &lt;/ResourceDictionary&gt;
    &lt;/Application.Resources&gt;
&lt;/Application&gt;</pre></div>

<p> </p>

<p>再回到我們的UI，把本來Hard Code寫死的字串改用Resource，像是"{DynamicResource TestString}"。這樣在UI的設計界面起碼就可以看到預設的語系畫面，也可以確定資源套用這部分是否是OK的。</p>

<div id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:6c0432f9-08db-4ae4-a916-c67eeab00af7" class="wlWriterSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre name="code" class="xml">&lt;Window x:Class="WpfApplication5.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="MainWindow"
        Width="525"
        Height="350"&gt;
    &lt;Grid&gt;
        &lt;Label HorizontalAlignment="Center"
               VerticalAlignment="Center"
               Content="{DynamicResource TestString}"
               FontSize="70" /&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;
</pre></div>

<p> </p>

<p>資源套用都確定OK後，我們要開始依照語系去抽換使用到的資源檔，這部分要在App.xaml檔那邊去處理Application.Startup事件進行抽換(在建構子進行抽換的動作是無效的)。抽換資源檔時我們只要判斷是要切換到何語系(可能是讀登錄檔或是當前語系，這邊是看產品的需求)，由要切換的語系推斷出我們要抽換到哪個Resource檔，然後將該Resource檔載入到MergedDictionaries就可以了。詳細的實作可參閱下方的程式碼：</p>

<div id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:f1d5afdb-227f-4a98-bc07-ca2d09ff7a2b" class="wlWriterSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre name="code" class="xml">		private void Application_Startup(object sender, StartupEventArgs e)
		{
			ApplyMultiLanguageResource();
		}

		private void ApplyMultiLanguageResource()
		{
			ApplyMultiLanguageResource(CultureInfo.CurrentCulture);
		}

		private void ApplyMultiLanguageResource(CultureInfo cultureInfo)
		{
			var cultureName = cultureInfo.Name;
			var resourceFile = string.Empty;

			try
			{
				resourceFile = @"StringResources." + cultureName + ".xaml ";
			}
			catch (Exception)
			{
			}

			if (string.IsNullOrEmpty(resourceFile))
				resourceFile = @"StringResources.xaml";

			var rd = Application.LoadComponent(new Uri(resourceFile, UriKind.Relative)) as ResourceDictionary;

			var existsRD = this.Resources.MergedDictionaries.Where(item =&gt; item.Source.OriginalString.Equals(resourceFile, StringComparison.CurrentCultureIgnoreCase)).FirstOrDefault();

			if (existsRD != null)
				this.Resources.MergedDictionaries.Remove(existsRD);

			this.Resources.MergedDictionaries.Add(rd);
		}
	}</pre></div>

<p> </p>

<p>實際運行後我們可以看到語系會正常的切換。</p>

<p><img style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px" border="0" alt="image" src="\images\posts\4066d006-7d5c-4080-9dd8-fbe285bc438d\image_thumb.png" width="659" height="578" /> </p>

<p> </p>

<p>若是程式中要使用，像是在做訊息的多語，可以像下面這樣：</p>

<div id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:484d79bd-9fba-474d-9f46-148376d7a26f" class="wlWriterSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre name="code" class="c#">string text = (string)Application.Current.FindResource("TestString");</pre></div>