---
layout: post
title: "[VB.NET]用.NET實作檔案總管"
date: 2009-07-03 12:01:31
comments: true
categories: [VB.NET]
description: "[VB.NET]用.NET實作檔案總管"
---
<p>要用.NET實作檔案總管的功能，相信應該都難不倒大家。但我也相信應該很多人都是一次取得所有電腦內的檔案與目錄清單，一次的把清單給塞到介面上。如果你不是習慣這樣寫的人，那恭喜您可以跳過這篇了。如果恰巧你就是這樣寫的，請耐著性子往下看吧。</p><p>要實作檔案總管功能又要兼顧效率，我們在寫作時勢必不能一次把所有檔案目錄清單給塞到介面。取而代之的是，我們可以只塞下一層的目錄與檔案。範例程式碼如下：</p><div style="width: 648px; height: 412px; overflow: auto"><div class="csharpcode"><pre class="alt"><span class="kwrd">Imports</span> System.IO</pre><pre>
 </pre><pre class="alt"><span class="kwrd">Public</span> <span class="kwrd">Class</span> Form1</pre><pre>
 </pre><pre class="alt">
    <span class="kwrd">Private</span> <span class="kwrd">Sub</span> Form1_Load(<span class="kwrd">ByVal</span> sender <span class="kwrd">As</span> System.<span class="kwrd">Object</span>, <span class="kwrd">ByVal</span> e <span class="kwrd">As</span> System.EventArgs) <span class="kwrd">Handles</span> <span class="kwrd">MyBase</span>.Load</pre><pre>
        InitTreeView()</pre><pre class="alt">
    <span class="kwrd">End</span> <span class="kwrd">Sub</span></pre><pre>
 </pre><pre class="alt">
    <span class="kwrd">Private</span> <span class="kwrd">Sub</span> InitTreeView()</pre><pre>
        <span class="kwrd">Dim</span> node <span class="kwrd">As</span> TreeNode</pre><pre class="alt">
        TreeView1.BeginUpdate()</pre><pre>
        <span class="kwrd">For</span> <span class="kwrd">Each</span> driver <span class="kwrd">As</span> DriveInfo <span class="kwrd">In</span> DriveInfo.GetDrives()</pre><pre class="alt">
            node = TreeView1.Nodes.Add(driver.Name)</pre><pre>
            <span class="kwrd">If</span> driver.IsReady <span class="kwrd">Then</span></pre><pre class="alt">
                AddDirectorys(node)</pre><pre>
                AddFiles(node)</pre><pre class="alt">
                node.Tag = <span class="kwrd">True</span></pre><pre>
            <span class="kwrd">End</span> <span class="kwrd">If</span></pre><pre class="alt">
        <span class="kwrd">Next</span></pre><pre>
        TreeView1.EndUpdate()</pre><pre class="alt">
    <span class="kwrd">End</span> <span class="kwrd">Sub</span></pre><pre>
 </pre><pre class="alt">
    <span class="kwrd">Private</span> <span class="kwrd">Sub</span> AddDirectorys(<span class="kwrd">ByVal</span> node <span class="kwrd">As</span> TreeNode)</pre><pre>
        <span class="kwrd">If</span> <span class="kwrd">CBool</span>(node.Tag) = <span class="kwrd">True</span> <span class="kwrd">Then</span></pre><pre class="alt">
            <span class="kwrd">Return</span></pre><pre>
        <span class="kwrd">End</span> <span class="kwrd">If</span></pre><pre class="alt">
 </pre><pre>
        <span class="kwrd">Try</span></pre><pre class="alt">
            TreeView1.BeginUpdate()</pre><pre>
            <span class="kwrd">For</span> <span class="kwrd">Each</span> dir <span class="kwrd">As</span> <span class="kwrd">String</span> <span class="kwrd">In</span> Directory.GetDirectories(node.FullPath)</pre><pre class="alt">
                node.Nodes.Add(dir.Substring(dir.LastIndexOf(<span class="str">"\"</span>) + 1))</pre><pre>
            <span class="kwrd">Next</span></pre><pre class="alt">
        <span class="kwrd">Catch</span> ex <span class="kwrd">As</span> Exception</pre><pre>
        <span class="kwrd">Finally</span></pre><pre class="alt">
            TreeView1.EndUpdate()</pre><pre>
        <span class="kwrd">End</span> <span class="kwrd">Try</span></pre><pre class="alt">
 </pre><pre>
    <span class="kwrd">End</span> <span class="kwrd">Sub</span></pre><pre class="alt">
 </pre><pre>
    <span class="kwrd">Private</span> <span class="kwrd">Sub</span> AddFiles(<span class="kwrd">ByVal</span> node <span class="kwrd">As</span> TreeNode)</pre><pre class="alt">
        <span class="kwrd">If</span> <span class="kwrd">CBool</span>(node.Tag) = <span class="kwrd">True</span> <span class="kwrd">Then</span></pre><pre>
            <span class="kwrd">Return</span></pre><pre class="alt">
        <span class="kwrd">End</span> <span class="kwrd">If</span></pre><pre>
 </pre><pre class="alt">
        <span class="kwrd">Try</span></pre><pre>
            TreeView1.BeginUpdate()</pre><pre class="alt">
            <span class="kwrd">For</span> <span class="kwrd">Each</span> file <span class="kwrd">As</span> <span class="kwrd">String</span> <span class="kwrd">In</span> Directory.GetFiles(node.FullPath)</pre><pre>
                node.Nodes.Add(My.Computer.FileSystem.GetName(file))</pre><pre class="alt">
            <span class="kwrd">Next</span></pre><pre>
        <span class="kwrd">Catch</span> ex <span class="kwrd">As</span> Exception</pre><pre class="alt">
        <span class="kwrd">Finally</span></pre><pre>
            TreeView1.EndUpdate()</pre><pre class="alt">
        <span class="kwrd">End</span> <span class="kwrd">Try</span></pre><pre>
    <span class="kwrd">End</span> <span class="kwrd">Sub</span></pre><pre class="alt">
 </pre><pre>
    <span class="kwrd">Private</span> <span class="kwrd">Sub</span> TreeView1_BeforeExpand(<span class="kwrd">ByVal</span> sender <span class="kwrd">As</span> System.<span class="kwrd">Object</span>, <span class="kwrd">ByVal</span> e <span class="kwrd">As</span> System.Windows.Forms.TreeViewCancelEventArgs) <span class="kwrd">Handles</span> TreeView1.BeforeExpand</pre><pre class="alt">
        <span class="kwrd">For</span> <span class="kwrd">Each</span> node <span class="kwrd">As</span> TreeNode <span class="kwrd">In</span> e.Node.Nodes</pre><pre>
            AddDirectorys(node)</pre><pre class="alt">
        <span class="kwrd">Next</span></pre><pre>
        AddFiles(e.Node)</pre><pre class="alt">
        e.Node.Tag = <span class="kwrd">True</span></pre><pre>
    <span class="kwrd">End</span> <span class="kwrd">Sub</span></pre><pre class="alt"><span class="kwrd">End</span> <span class="kwrd">Class</span></pre></div></div><p /><style type="text/css"><![CDATA[

.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style><p> </p><p>執行畫面</p><p><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" width="304" height="304" src="\images\posts\9095\image_thumb.png" /></a> <a href="http://files.dotblogs.com.tw/larrynung/0907/9d0fe6f68d27.NET_13932/image_4.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" width="304" height="304" src="\images\posts\9095\image_thumb_1.png" /></p>