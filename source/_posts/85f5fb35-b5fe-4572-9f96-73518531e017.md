---
layout: post
title: "[C#]Set Windows 7 Progress Bar's State"
date: 2013-11-06 12:00:00
comments: true
categories: 
description: "[C#]Set Windows 7 Progress Bar's State"
---
<p>要在Win7設定Progressbar的運行狀態，可能是一般運行狀態，可能是暫停狀態，或是錯誤狀態。</p>  <p><img style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" border="0" alt="image" src="\images\posts\85f5fb35-b5fe-4572-9f96-73518531e017\image_thumb_4.png" width="429" height="181" /></a> </p>  <p> </p>  <p>我們可以透過SendMessage發送PBM_SETSTATE訊息給ProgressBar，訊息的wParam依需求可帶入PBST_NORMAL、PBST_ERROR、與PBST_PAUSED，lParam部分則帶入0就可以了。</p>  <p><a href="http://files.dotblogs.com.tw/larrynung/1202/e82d075458e7_B556/image_8.png"><img style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" border="0" alt="image" src="\images\posts\85f5fb35-b5fe-4572-9f96-73518531e017\image_thumb_3.png" width="563" height="484" /> </p>  <p> </p>  <p>程式撰寫起來會像下面這樣：</p>  <p>   </p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:c605bd07-b1fe-4833-8b3b-d61194fe571b" class="wlWriterSmartContent"><pre name="code" class="c#">        #region Const
        const int PBM_SETSTATE = 0x410;
        const int PBST_PAUSE = 0x0003;
        const int PBST_ERROR = 0x0002;
        const int PBST_NORMAL = 0x0001;
        #endregion


        #region DllImport
        [DllImport("user32.dll", CharSet = CharSet.Auto)]
        internal static extern int SendMessage(IntPtr hWnd, int wMsg, int wParam, int lParam); 
        #endregion

        #region Private Method
        void SetPaused(ProgressBar progressBar)
        {
            SendMessage(progressBar.Handle, PBM_SETSTATE, PBST_PAUSE, 0);
        }

        void SetError(ProgressBar progressBar)
        {
            SendMessage(progressBar.Handle, PBM_SETSTATE, PBST_ERROR, 0);
        }

        void SetNormal(ProgressBar progressBar)
        {
            SendMessage(progressBar.Handle, PBM_SETSTATE, PBST_NORMAL, 0);
        } 
        #endregion</pre></div>


<p> </p>

<p>這邊用此概念做個簡單的示意範例：</p>

<p>
  </p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:a8eee87e-bfc3-46ee-bd80-9ced6dd6bb0f" class="wlWriterSmartContent"><pre name="code" class="c#">using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace WindowsFormsApplication3
{
    public partial class Form1 : Form
    {
        #region Const
        const int PBM_SETPOS = 0x402;
        const int PBM_GETPOS = 0x0408;
        const int PBM_SETSTATE = 0x410;
        const int PBST_PAUSE = 0x0003;
        const int PBST_ERROR = 0x0002;
        const int PBST_NORMAL = 0x0001;
        #endregion


        #region DllImport
        [DllImport("user32.dll", CharSet = CharSet.Auto)]
        internal static extern int SendMessage(IntPtr hWnd, int wMsg, int wParam, int lParam); 
        #endregion

        #region Private Method
        void SetPaused(ProgressBar progressBar)
        {
            SendMessage(progressBar.Handle, PBM_SETSTATE, PBST_PAUSE, 0);
        }

        void SetError(ProgressBar progressBar)
        {
            SendMessage(progressBar.Handle, PBM_SETSTATE, PBST_ERROR, 0);
        }

        void SetNormal(ProgressBar progressBar)
        {
            SendMessage(progressBar.Handle, PBM_SETSTATE, PBST_NORMAL, 0);
        } 
        #endregion

        public Form1()
        {
            InitializeComponent();
        }

        private void trackBar1_Scroll(object sender, EventArgs e)
        {
            SendMessage(progressBar1.Handle, PBM_SETPOS, trackBar1.Value, 0);
        }

        private void button1_Click(object sender, EventArgs e)
        {
            SetNormal(progressBar1);
        }

        private void button2_Click(object sender, EventArgs e)
        {
            SetPaused(progressBar1);
        }

        private void button3_Click(object sender, EventArgs e)
        {
            SetError(progressBar1);
        }
    }
}</pre></div>


<p> </p>

<p>當按下不同狀態按鈕，ProgressBar會有不同的呈現。</p>

<p />

<p><img style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" border="0" alt="image" src="\images\posts\85f5fb35-b5fe-4572-9f96-73518531e017\image_thumb.png" width="304" height="182" /> </p>

<p><img style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" border="0" alt="image" src="\images\posts\85f5fb35-b5fe-4572-9f96-73518531e017\image_thumb_1.png" width="304" height="182" /> </p>

<p><img style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" border="0" alt="image" src="\images\posts\85f5fb35-b5fe-4572-9f96-73518531e017\image_thumb_2.png" width="304" height="182" /> </p>

<p> </p>

<p>為了方便起見也可以將之整理成擴充方法。</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:36093ea9-e34a-40fe-915b-f7c09dd0c4aa" class="wlWriterSmartContent"><pre name="code" class="c#">    public static class ProgressExtension
    {
        #region Const
        const int PBM_SETSTATE = 0x410;
        const int PBST_PAUSE = 0x0003;
        const int PBST_ERROR = 0x0002;
        const int PBST_NORMAL = 0x0001;
        #endregion
        
        #region DllImport
        [DllImport("user32.dll", CharSet = CharSet.Auto)]
        internal static extern int SendMessage(IntPtr hWnd, int wMsg, int wParam, int lParam);
        #endregion

        #region Public Method
        public static void SetNormalState(this ProgressBar progressBar)
        {
            SendMessage(progressBar.Handle, PBM_SETSTATE, PBST_NORMAL, 0);
        }

        public static void SetPauseState(this ProgressBar progressBar)
        {
            SendMessage(progressBar.Handle, PBM_SETSTATE, PBST_PAUSE, 0);
        }

        public static void SetErrorState(this ProgressBar progressBar)
        {
            SendMessage(progressBar.Handle, PBM_SETSTATE, PBST_ERROR, 0);
        } 
        #endregion
    }</pre></div>

<p> </p>

<p>使用上會更為方便簡潔。</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:9c81b37e-d0ee-41b2-bbc9-7bc54db3b766" class="wlWriterSmartContent"><pre name="code" class="c#">    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void trackBar1_Scroll(object sender, EventArgs e)
        {
            progressBar1.Value = trackBar1.Value;
        }

        private void button1_Click(object sender, EventArgs e)
        {
            progressBar1.SetNormalState();
        }

        private void button2_Click(object sender, EventArgs e)
        {
            progressBar1.SetPauseState();
        }

        private void button3_Click(object sender, EventArgs e)
        {
            progressBar1.SetErrorState();
        }
    }</pre></div>

<p> </p>

<h2>Link</h2>

<ul>
  <li>Windows 7 Progress Bars in .NET</li>

  <li>PBM_SETSTATE message</li>
</ul>