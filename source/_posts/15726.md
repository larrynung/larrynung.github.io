---
layout: post
title: "[VB.NET]從剪貼簿貼上至TextBox時的注意事項"
date: 2010-06-08 10:29:01
comments: true
tags: [VB.NET]
description: "[VB.NET]從剪貼簿貼上至TextBox時的注意事項"
---
<p>撰寫從剪貼簿貼上的程式有兩種方式，一種是利用Clipboard.GetText去取得剪貼簿內的文字後，自行處理塞值的動作，像是下面這樣：</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:ba482e70-f404-4de7-b4c7-53a523266971" class="wlWriterEditableSmartContent"><pre name="code" class="vb">TextBox1.Text = Clipboard.GetText</pre></div>

<p> </p>

<p>另一種則是透過SendKeys.Send模擬鍵盤按下Ctrl+V，像是下面這樣：</p>

<p />

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:f7414deb-6c98-48e9-b87d-2976ef15a6fe" class="wlWriterEditableSmartContent"><pre name="code" class="vb">TextBox1.Clear()
TextBox1.Focus()        
SendKeys.Send("^V")</pre></div>

<p />

<p> </p>

<p>這兩種方式都可以達到從剪貼簿貼上的效果，但是若程式中的TextBox有加設MaxLength的話，則建議採用SendKeys.Send的方法，因為若用Clipboard.GetText取得字串後自行塞入，貼上的字串長度是會可以超過MaxLength的設定的。MaxLength並沒有擋直接用程式塞字串的長度，只會檔住鍵盤直接Key In，或是貼上的字串。</p>

<p> </p>

<p>這邊來看段範例，首先在Form.Load設定一下MaxLength長度為100，剪貼簿內的資料長度為200。</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:49eeb36f-748f-4d2c-881c-9beadcbd1f6b" class="wlWriterEditableSmartContent"><pre name="code" class="vb">        TextBox1.MaxLength = 100
        Clipboard.SetText(New String("A"c, 200))</pre></div>

<p> </p>

<p>實際執行比較兩種方法，就可以看出這種現象。</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="\images\posts\15726\image_thumb_2.png" width="244" height="207" /></a> <a href="http://files.dotblogs.com.tw/larrynung/1006/VB.NET_128F8/image_8.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="\images\posts\15726\image_thumb_3.png" width="244" height="207" /> </p>

<p> </p>

<p>若想用Clipboard.GetText塞值，就必須自行處理：</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:463c8d0d-216b-43f8-8cf0-acb7e6d59e6a" class="wlWriterEditableSmartContent"><pre name="code" class="vb">        Dim msg As String = Clipboard.GetText
        If msg.Length &gt; TextBox1.MaxLength Then
            msg = msg.Substring(0, TextBox1.MaxLength)
        End If
        TextBox1.Text = msg</pre></div>