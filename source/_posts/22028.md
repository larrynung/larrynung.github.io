---
layout: post
title: "[C#]RaiseEvent Extension Method (一)"
date: 2011-03-23 01:11:00
comments: true
tags: [C#]
description: "[C#]RaiseEvent Extension Method (一)"
---
<p>
	今天再調整程式中的事件，又注意到C#的事件實在是很囉唆，每次觸發事件前都要判斷一下事件處理常式是否有繫上，有繫上才能做觸發的動作。這樣的檢查動作隨著事件的增多，重複撰寫相同的邏輯會變得非常的頻繁。而在VB.NET中事件的觸發相較之下就容易得多，不需要自行判斷事件處理常式是否繫上，直接叫用RaiseEvent觸發事件就可以了。因此想說是否可以把這部分工作提出來，試了一下提出來後仍舊運行良好，這邊將其整理成擴充方法：</p>
<p>
	public static class ObjectExtension<br />
	{<br />
	    public static void RaiseEvent(this object obj, EventHandler handler, EventArgs e)<br />
	    {<br />
	        if (handler == null)<br />
	            return;<br />
	        handler(obj, e);<br />
	    }</p>
<p>
	    public static void RaiseEvent&lt;TEventArgs&gt;(this object obj, EventHandler&lt;TEventArgs&gt; handler, TEventArgs e) where TEventArgs : EventArgs<br />
	    {<br />
	        if (handler == null)<br />
	            return;<br />
	        handler(obj, e);<br />
	    }<br />
	}</p>
<p>
	 </p>
<p>
	使用上帶入EventHandler與事件的參數就可以了：</p>
<p>
	public event EventHandler NameChanged;</p>
<p>
	...</p>
<p>
	this.RaiseEvent(NameChanged, EventArgs.Empty);</p>
<p>
	...</p>
<p>
	 </p>
<p>
	完整程式碼範例：</p>
<p>
	using System;<br />
	using System.Collections.Generic;<br />
	using System.Linq;<br />
	using System.Text;</p>
<p>
	namespace ConsoleApplication2<br />
	{<br />
	    class Program<br />
	    {<br />
	        static void Main(string[] args)<br />
	        {<br />
	            Person Larry = new Person();<br />
	            Larry.NameChanged += new EventHandler(Larry_NameChanged);<br />
	            Larry.Name = "Larry";           <br />
	        }</p>
<p>
	        static void Larry_NameChanged(object sender, EventArgs e)<br />
	        {<br />
	            Console.WriteLine("NameChanged...");<br />
	        }<br />
	    }</p>
<p>
	    public static class ObjectExtension<br />
	    {<br />
	        public static void RaiseEvent(this object obj, EventHandler handler, EventArgs e)<br />
	        {<br />
	            if (handler == null)<br />
	                return;<br />
	            handler(obj, e);<br />
	        }</p>
<p>
	        public static void RaiseEvent&lt;TEventArgs&gt;(this object obj, EventHandler&lt;TEventArgs&gt; handler, TEventArgs e) where TEventArgs : EventArgs<br />
	        {<br />
	            if (handler == null)<br />
	                return;<br />
	            handler(obj, e);<br />
	        }<br />
	    }</p>
<p>
	    class Person<br />
	    {<br />
	        private string _name;<br />
	        public string Name<br />
	        {<br />
	            get<br />
	            {<br />
	                if (_name == null)<br />
	                    return string.Empty;<br />
	                return _name;<br />
	            }<br />
	            set<br />
	            {<br />
	                if (_name != value)<br />
	                {<br />
	                    _name = value;                     <br />
	                    this.RaiseEvent(NameChanged, EventArgs.Empty);<br />
	                }<br />
	            }<br />
	        }</p>
<p>
	        public event EventHandler NameChanged;</p>
<p>
	    }</p>
<p>
	}</p>
<p>
	 </p>
<p>
	運行結果：</p>
<p>
	<img alt="image" border="0" height="143" src="\images\posts\22028\image_thumb.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="369" /></p>
