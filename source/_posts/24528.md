---
layout: post
title: "[C#][Visual Studio]使用DebuggerTypeProxyAttribute客製除錯資訊"
date: 2011-05-08 07:33:11
comments: true
tags: [Visual Studio,C#]
description: "[C#][Visual Studio]使用DebuggerTypeProxyAttribute客製除錯資訊"
---
<p>
	有時候我們在撰寫類別時，因為功能上的需求有時會將類別加入許多的額外資訊，有些資訊可能在某些情況下我們必須要能夠取得並查看，但有些資訊則是在大多數的情況下不是我們所關注的焦點，尤其是在除錯時更是如此的話，會在無形之中增加除錯人員除錯上的困難，此時我們可以透過DebuggerTypeProxyAttribute為該類別客製我們所需要的除錯資訊。</p>
<p>
	 </p>
<p>
	透過DebuggerTypeProxyAttribute我們可以將類別的除錯資訊精簡化，也可以為類別增添一些方便用以查閱的資訊。這樣的做法其實在BCL中也用了很多。以Hashtable類別為例，在我們監看Hashtable物件時，會看到下面的畫面。上方顯示我們使用Hashtable時所會關心的Key/Value的集合，最下面會有一個Raw View用以隱藏物件本來的除錯資訊。</p>
<p>
	<img alt="image" border="0" height="153" src="\images\posts\24528\image_thumb_2.png" style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" width="495" /></p>
<p>
	<img alt="image" border="0" height="369" src="\images\posts\24528\image_thumb_3.png" style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" width="606" /></p>
<p>
	 </p>
<p>
	在實作上需為要客製化的類別準備一個用於顯示除錯資訊的輔助類別，該輔助類別的建購子會傳入所要客製化除錯資訊的類別物件，並用公開屬性開出所想要顯示在監看視窗中的資訊，就像下面這樣：</p>
<p>
	    public class MyHashTableDebuggerProxy<br />
	    {<br />
	        #region Property<br />
	        public int Count { get; set; }<br />
	        #endregion</p>
<p>
	        #region Constructor<br />
	        public MyHashTableDebuggerProxy(MyHashTable value)<br />
	        {<br />
	            this.Count = value.Count;<br />
	        }<br />
	        #endregion<br />
	    }</p>
<p>
	 </p>
<p>
	最後為要客製化的類別加上DebuggerTypeProxy屬性，指定客製化資訊要由哪個輔助類別取得，整個除錯資訊的客製化就完成了。</p>
<p>
	      [DebuggerTypeProxy(typeof(ConsoleApplication4.MyHashTableDebuggerProxy))]<br />
	    public class MyHashTable : Hashtable<br />
	    { }</p>
<p>
	 </p>
<p>
	完整範例如下：</p>
<p>
	using System;<br />
	using System.Diagnostics;<br />
	using System.Runtime.InteropServices;<br />
	using System.Security;<br />
	using System.Text;<br />
	using System.Collections;</p>
<p>
	namespace ConsoleApplication4<br />
	{<br />
	    class Program<br />
	    {<br />
	        static void Main(string[] args)<br />
	        {<br />
	            MyHashTable table = new MyHashTable();<br />
	            table.Add("Blog", "Level Up");<br />
	            table.Add("Url", "http://www.dotblogs.com.tw/larrynung");<br />
	            Console.Read();<br />
	        }<br />
	    }</p>
<p>
	    [DebuggerTypeProxy(typeof(ConsoleApplication4.MyHashTableDebuggerProxy))]<br />
	    public class MyHashTable : Hashtable<br />
	    { }</p>
<p>
	    public class MyHashTableDebuggerProxy<br />
	    {<br />
	        #region Property<br />
	        public int Count { get; set; }<br />
	        #endregion</p>
<p>
	        #region Constructor<br />
	        public MyHashTableDebuggerProxy(MyHashTable value)<br />
	        {<br />
	            this.Count = value.Count;<br />
	        }<br />
	        #endregion<br />
	    }<br />
	}</p>
<p>
	 </p>
<p>
	運行結果如下：</p>
<p>
	<img alt="image" border="0" height="109" src="\images\posts\24528\image_thumb.png" style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" width="444" /></p>
<p>
	<img alt="image" border="0" height="462" src="\images\posts\24528\image_thumb_1.png" style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" width="615" /></p>
<p>
	 </p>
<h2>
	Link</h2>
<ul>
	<li>
		DebuggerTypeProxyAttribute 類別</li>
	<li>
		使用 DebuggerTypeProxy 屬性</li>
</ul>
