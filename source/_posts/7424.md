---
layout: post
title: "[Performance][VB.NET]If V.S IIf"
date: 2009-03-10 09:00:26
comments: true
categories: [VB.NET,Performance]
description: "[Performance][VB.NET]If V.S IIf"
---
<p> </p>  <p>前陣子去書局翻書，看到一本寫的不錯的VB.NET入門書，很適合初學者學習使用，作者是施威明工作室。稍微翻了一下，雖是簡單的入門書，但書中仍是有些我沒注意到的東西，像是這篇提到的If函式。開始用VB.NET到現在也已經一年多了，一直以為If就只能當陳述式用，看了書上描述才知道原來也有類似IIf的用法。</p>  <p>但若是If跟IIf功用完全一樣的話，又為何要有兩道函式呢？書上做了些許的描述，主要的差異是If的效率會比IIf好，也就是會比較快。</p>  <p> </p>  <p>其用法與說明簡列如下：</p>  <table border="0" cellspacing="0" cellpadding="2" width="852"><tbody>     <tr>       <td valign="top" width="394"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\7424\image_thumb_4.png" width="518" height="60" /></a> <a href="http://files.dotblogs.com.tw/larrynung/0903/VB.NETIfV.SIIF_12A5D/image_2.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\7424\image_thumb.png" width="389" height="60" /></a></td>        <td valign="top" width="456"><a href="http://files.dotblogs.com.tw/larrynung/0903/VB.NETIfV.SIIF_12A5D/image_4.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\7424\image_thumb_1.png" width="450" height="50" /></a></td>     </tr>   </tbody></table>  <p> </p>  <p>基本上If三個參數的多載函式用法幾乎跟IIf一樣，硬要說有啥不同的話，大概只有兩點，第一點差異就是If的後兩個參數需能互相擴展轉換(也許說成相同型態會更為恰當，這邊採用Visual Studio說明的說法)，所以像下圖的寫法就會跑出錯誤。</p>  <p><a href="http://files.dotblogs.com.tw/larrynung/0903/VB.NETIfV.SIIF_12A5D/image_12.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\7424\image_thumb_5.png" width="649" height="36" /></a></p>  <p>而IIf無此限制，因此像下圖這樣寫法就無錯誤出現。</p>  <p><a href="http://files.dotblogs.com.tw/larrynung/0903/VB.NETIfV.SIIF_12A5D/image_14.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\7424\image_thumb_6.png" width="261" height="21" /></a></p>  <p>第二點差異就是If前面需有變數去接收函式回傳值，若前面無變數去接收回傳值，Visual Studio會將它視為是If陳述式，因此會出現如下錯誤：</p>  <p><a href="http://files.dotblogs.com.tw/larrynung/0903/VB.NETIfV.SIIF_12A5D/image_16.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\7424\image_thumb_7.png" width="195" height="40" /></a></p>  <p>同樣的IIf無此限制，因此不會出現錯誤，最多只能算是沒啥意義的寫法。</p>  <p><a href="http://files.dotblogs.com.tw/larrynung/0903/VB.NETIfV.SIIF_12A5D/image_20.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\7424\image_thumb_9.png" width="148" height="28" /></p>  <p> </p>  <p>接著我們順便來看一下If兩個參數的多載函式的用法，簡單來說該函式的用法就是當第一個參數不為Nothing，該函式的回傳值就為第一個參數，反之若第一個參數為Nothing，該函式的回傳值就為第二個參數。看個簡單的範例，假設今天我們宣告了一個TextBox如下：</p>  <div class="csharpcode">   <pre class="alt"><span class="kwrd">Dim</span> tbx <span class="kwrd">As</span> TextBox = Nothing</pre>
</div>

<p>若是這樣宣告，則當我們要使用該TextBox時會需要去判斷TextBox是否是Nothing，若是，我們會去New出TextBox物件，我們寫的Code可能會長的像下面這樣：</p>

<div class="csharpcode">
  <pre class="alt"><span class="kwrd">If</span> tbx <span class="kwrd">Is</span> <span class="kwrd">Nothing</span> <span class="kwrd">Then</span> tbx = <span class="kwrd">New</span> TextBox</pre>
</div>

<p>若此時運用If函式的話，寫法大概如下：</p>

<div class="csharpcode">
  <pre class="alt">tbx = <span class="kwrd">If</span>(tbx, <span class="kwrd">New</span> TextBox)</pre>
</div>

<p> </p>

<p>了解了用法以後，我們當然不能錯過比較兩者之間速度上的差異，畢竟這是兩者最大的不同點。為了測試我們撰寫如下的測試程式：</p>

<p> </p>

<div class="csharpcode">
  <pre class="alt">    <span class="kwrd">Private</span> <span class="kwrd">Sub</span> TestIfAndIIf(<span class="kwrd">ByVal</span> loopCount <span class="kwrd">As</span> <span class="kwrd">Integer</span>)</pre>

  <pre>        <span class="kwrd">Dim</span> sw <span class="kwrd">As</span> <span class="kwrd">New</span> Stopwatch</pre>

  <pre class="alt">        <span class="kwrd">Dim</span> o <span class="kwrd">As</span> <span class="kwrd">Object</span></pre>

  <pre> </pre>

  <pre class="alt">        Console.WriteLine(<span class="str">"Test If"</span>)</pre>

  <pre>        sw.Start()</pre>

  <pre class="alt">        <span class="kwrd">For</span> i <span class="kwrd">As</span> <span class="kwrd">Integer</span> = 1 <span class="kwrd">To</span> loopCount</pre>

  <pre>            o = <span class="kwrd">If</span>(<span class="kwrd">True</span>, <span class="kwrd">True</span>, <span class="kwrd">False</span>)</pre>

  <pre class="alt">        <span class="kwrd">Next</span></pre>

  <pre>        Console.WriteLine(<span class="str">"花費時間: "</span> &amp; sw.ElapsedMilliseconds)</pre>

  <pre class="alt">        sw.Reset()</pre>

  <pre> </pre>

  <pre class="alt">        Console.WriteLine(<span class="str">"Test IIf"</span>)</pre>

  <pre>        sw.Start()</pre>

  <pre class="alt">        <span class="kwrd">For</span> i <span class="kwrd">As</span> <span class="kwrd">Integer</span> = 1 <span class="kwrd">To</span> loopCount</pre>

  <pre>            o = IIf(<span class="kwrd">True</span>, <span class="kwrd">True</span>, <span class="kwrd">False</span>)</pre>

  <pre class="alt">        <span class="kwrd">Next</span></pre>

  <pre>        Console.WriteLine(<span class="str">"花費時間: "</span> &amp; sw.ElapsedMilliseconds)</pre>

  <pre class="alt">    <span class="kwrd">End</span> Sub</pre>
</div>

<p> </p>


<p> </p>

<p>測試結果如下：</p>

<table border="1" cellspacing="0" cellpadding="2" width="400"><tbody>
    <tr>
      <td valign="top" width="133">loopCount</td>

      <td valign="top" width="133">If</td>

      <td valign="top" width="133">IIf</td>
    </tr>

    <tr>
      <td valign="top" width="133">10000</td>

      <td valign="top" width="133">0 ms</td>

      <td valign="top" width="133">0 ms</td>
    </tr>

    <tr>
      <td valign="top" width="133">100000</td>

      <td valign="top" width="133">1 ms</td>

      <td valign="top" width="133">3 ms</td>
    </tr>

    <tr>
      <td valign="top" width="133">1000000</td>

      <td valign="top" width="133">10 ms</td>

      <td valign="top" width="133">32 ms</td>
    </tr>

    <tr>
      <td valign="top" width="133">10000000</td>

      <td valign="top" width="133">101 ms</td>

      <td valign="top" width="133">326 ms</td>
    </tr>
  </tbody></table>

<p> </p>

<p>統計一下測試數據</p>

<p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="image" border="0" alt="image" src="\images\posts\7424\image_thumb.png" width="487" height="295" /> </p>

<p> </p>

<p>可以清楚的看出兩者間速度的比約為 1:3，不過這是當使用很多次的情況之下，在使用次數小於100000次的情況下，其間速度的差異幾乎可忽略不計。</p>