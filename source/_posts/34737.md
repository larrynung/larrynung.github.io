---
layout: post
title: "[C++][Visual Studio]Visual studio 2010 C++0x new feature: decltype"
date: 2011-08-30 12:55:08
comments: true
categories: [Visual Studio,C++]
description: "[C++][Visual Studio]Visual studio 2010 C++0x new feature: decltype"
---
<p>
	Visual studio 2010為C++的開發人員新增了decltype這個C++0x的功能，能根據所給的運算式決定型別，使用時只要在decltype關鍵字後面用小括號圍住要判斷的運算式，即可推斷出運算式回傳的型態，並加以進一步去做些處理。</p>
<div class="wlWriterSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:b6b907eb-5f31-404c-967f-6f1076eca6b5" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
	<pre class="c" name="code">
decltype( expression )</pre>
</div>
<p>
	 </p>
<p>
	像是下面這個例子就非常的簡單，程式宣告了整數變數a，而變數b的型態我們想由a去推斷，可以像下面這樣撰寫:</p>
<div class="wlWriterSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:ab2f40af-0a96-447f-98b9-4fb1401cb36a" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
	<pre class="c" name="code">
int a;
decltype(a) b;
decltype(Test()) c;
decltype(Test() + 1) d;</pre>
</div>
<p>
	 </p>
<p>
	這樣的型態判別動作跟區域型別推斷一樣是由Compile完成的，在編譯器中可以直接看到宣告的型態，運行階段不會產生額外的性能耗費。</p>
<p>
	<img alt="image" border="0" height="278" src="\images\posts\34737\image_thumb_3.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="448" /></p>
<p>
	 </p>
<p>
	decltype關鍵字還能更進一步的與auto一起使用，簡化 template 函式的開發，撰寫上會像下面這樣的形式：</p>
<div class="wlWriterSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:8a9b07c6-0f19-4e71-8a0c-8310afd0a5fb" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
	<pre class="c" name="code">
auto function_name( parameters ) −&gt; decltype( expression ) { function_body; }</pre>
</div>
<p>
	 </p>
<p>
	這樣撰寫的好處是方法的回傳值是由運算式去決定的，以下面的例子來看方法的回傳值是x + y後回傳的型態。</p>
<p>
	<img alt="image" border="0" height="266" src="\images\posts\34737\image_thumb_2.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="439" /></p>
<p>
	 </p>
<p>
	在開發上若是能善用這樣的功能，搭配template下去開發，能為開發人員減少不少的工作量。</p>
