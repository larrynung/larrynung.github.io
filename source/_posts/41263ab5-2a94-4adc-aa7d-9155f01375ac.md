---
layout: post
title: "[Visual Studio]透過Visual Studio 2012的選擇性貼上將XML與JSON直接轉成對應的類別"
date: 2013-11-06 12:00:00
comments: true
tags: 
description: "[Visual Studio]透過Visual Studio 2012的選擇性貼上將XML與JSON直接轉成對應的類別"
---
<p>
	在開發專案時若碰到要串接服務或是他人的API，常常避免不了都要面對XML或是JSON這兩種Data Format。以.NET的開發者來說XML這邊可以直接用Linq to XML或是XPath處理掉，JSON也可以透過JSON.NET避開產生對應的類別後去解序列化。但是難免總是會有些狀況我們不得不面對這樣的問題，這時若是是JSON的Format很多開發者可能就會使用json2csharp去輔助產生對應的類別。</p>
<p>
	 </p>
<p>
	不過其實我們可以不需要額外的網站輔助，也不需要勞心勞力的手動去建立。因為在Visual Studio 2012中新增了選擇性貼上的功能，能將剪貼簿中的XML內容直接貼成對應的類別。</p>
<p>
	 </p>
<p>
	像是以土豆為例，我們呼叫API：</p>
<p>
	http://api.tudou.com/v3/gw?method=album.channel.get&amp;appKey=myKey&amp;format=xml&amp;channel=z&amp;pageNo=1&amp;pageSize=10</p>
<p>
	 </p>
<p>
	取得的XML會長的像下面這樣：</p>
<p>
	<img alt="image" border="0" height="484" src="\images\posts\41263ab5-2a94-4adc-aa7d-9155f01375ac\image_thumb.png" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px" width="566" /></p>
<p>
	 </p>
<p>
	這時我們就可以在Visual Studio 2012中新增個類別檔案去存放對應的類別。</p>
<p>
	<img alt="image" border="0" height="417" src="\images\posts\41263ab5-2a94-4adc-aa7d-9155f01375ac\image_thumb_1.png" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px" width="644" /></p>
<p>
	 </p>
<p>
	按下[Edit/Paste Special]選單內的[Paste XML As Classes]選單選項。</p>
<p>
	<img alt="image" border="0" height="489" src="\images\posts\41263ab5-2a94-4adc-aa7d-9155f01375ac\image_thumb_2.png" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px" width="525" /></p>
<p>
	 </p>
<p>
	剪貼簿內的XML內容就會被貼成對應的類別，像是下圖這樣：</p>
<p>
	<img alt="image" border="0" height="484" src="\images\posts\41263ab5-2a94-4adc-aa7d-9155f01375ac\image_thumb_3.png" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px" width="591" /></p>
<p>
	 </p>
<p>
	如果API吐回的格式是JSON格式的話就比較麻煩一點，因為Visual Studio 2012尚未將這塊內建，不過你可以加裝ASP.NET and Web Tools。</p>
<p>
	<img alt="image" border="0" height="484" src="\images\posts\41263ab5-2a94-4adc-aa7d-9155f01375ac\image_thumb_4.png" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px" width="618" /></p>
<p>
	 </p>
<p>
	加裝ASP.NET and Web Tools後，我們再次看一下[Edit/Paste Special]下的選單選項，可以看到除了本來的[Paste XML As Classes]選單選項外，又多了一個[Paste JSON As Classes]的選單選項。</p>
<p>
	<img alt="image" border="0" height="464" src="\images\posts\41263ab5-2a94-4adc-aa7d-9155f01375ac\image_thumb_11.png" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px" width="538" /></p>
<p>
	 </p>
<p>
	這邊一樣用土豆為例，呼叫跟上面相同的API，但是將資料格式改為JSON。</p>
<p>
	http://api.tudou.com/v3/gw?method=album.channel.get&amp;appKey=myKey&amp;format=json&amp;channel=z&amp;pageNo=1&amp;pageSize=10</p>
<p>
	 </p>
<p>
	按下[Edit/Paste Special]選單內的[Paste JSON As Classes]選單選項，可以看到如預期的Visual Studio 2012幫我們產生了對應的類別。</p>
<p>
	<img alt="image" border="0" height="511" src="\images\posts\41263ab5-2a94-4adc-aa7d-9155f01375ac\image_thumb_12.png" style="border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px" width="505" /></p>
<p>
	 </p>
<p>
	這樣貼心的小功能是不是很方便呢？我們不在需要類似json2csharp這樣的網站輔助開發，串接API時也只要取得API的回傳值後用產生的類別解序列化，資料就可以直接透過物件下去存取。</p>
<p>
	 </p>
<p>
	這邊最後一提，Web Essentials 2012也有類似的功能能輔助我們將JSON的資料轉成對應的類別，有興趣的可參閱Will保哥的影片介紹：</p>
<div class="wlWriterSmartContent" id="scid:5737277B-5D6D-4f48-ABFC-DD9C333F4C5D:8619fbbd-6e7d-4681-9e64-d6b5a412e3a4" style="padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px">
	<div id="5d3543d3-a37e-4289-ad5d-e9b03f9e20c5" style="margin: 0px; padding: 0px; display: inline;">
		<div>
			<img alt="" galleryimg="no" onload="var downlevelDiv = document.getElementById('5d3543d3-a37e-4289-ad5d-e9b03f9e20c5'); downlevelDiv.innerHTML = &quot;&lt;div&gt;&lt;object width=\&quot;425\&quot; height=\&quot;350\&quot;&gt;&lt;param  data-cke-saved-name=\&quot;movie\&quot; name=\&quot;movie\&quot; value=\&quot;http://www.youtube.com/v/zwTbyn5VZh8\&quot;&gt;&lt;\/param&gt;&lt;param  data-cke-saved-name=\&quot;wmode\&quot; name=\&quot;wmode\&quot; value=\&quot;transparent\&quot;&gt;&lt;\/param&gt;&lt;embed  data-cke-saved-src=\&quot;http://www.youtube.com/v/zwTbyn5VZh8\&quot; src=\&quot;http://www.youtube.com/v/zwTbyn5VZh8\&quot; type=\&quot;application/x-shockwave-flash\&quot; wmode=\&quot;transparent\&quot; width=\&quot;425\&quot; height=\&quot;350\&quot;&gt;&lt;\/embed&gt;&lt;\/object&gt;&lt;\/div&gt;&quot;;" src="\images\posts\41263ab5-2a94-4adc-aa7d-9155f01375ac\video25923ff2a9df.jpg" /></div>
	</div>
</div>
<p>
	 </p>
<h2>
	Link</h2>
<ul>
	<li>
		活用 VS2012 擴充套件 - 將 JSON 轉換成 .NET 類別 (Web Essentials 2012)</li>
	<li>
		ASP.NET and Web Tools 2012.2</li>
	<li>
		TIP: “Paste XML as Classes” in Visual Studio 2012</li>
	<li>
		Generating Data Type Classes from XML</li>
	<li>
		VS 11 : Paste XML as Classes!</li>
	<li>
		Visual Studio 2012 – Paste XML as Classes</li>
	<li>
		‘Paste JSON As Classes’ in ASP.NET and Web Tools 2012.2 RC</li>
</ul>
