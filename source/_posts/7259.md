---
layout: post
title: "[.NET Concept][C#][VB.NET]四捨六入五成雙"
date: 2009-02-22 10:03:38
comments: true
tags: [C#,VB.NET,.NET Concept]
description: "[.NET Concept][C#][VB.NET]四捨六入五成雙"
---
<p>一般舊的程式語言在當把浮點數轉成整數時，通常會採用『四捨五入』的方式去做轉換的動作。顧名思義，就是當小數位數小於5的話則捨棄小數(四捨)、大於或等於5的話則進位(五入)。而這種年代久遠的處理方式其實存在著一個問題，就是其實它是不公平的，因為它進位的機率高於捨棄(見下圖)，在統計學上會產生偏差。</p><p><img border="0" alt="image" width="358" height="70" src="\images\posts\7259\image_thumb.png" /></p><p>所以為了避免偏差的問題，在.NET這種新的語言多半會使用『四捨六入五成雙』的方法來處理轉換的動作。所謂的『四捨六入五成雙』簡單的說起來就是當數值小於5的話則捨棄小數(四捨)、大於5的話則進位(六入)、等於5的話則依最接近的雙數來決定是進位或捨去(五成雙)。若要測試這種現象可使用下列程式碼。</p><p>VB.NET</p><div class="csharpcode"><pre class="alt"><span class="kwrd">Private</span> <span class="kwrd">Sub</span> ShowDoubleToInt(<span class="kwrd">ByVal</span> n <span class="kwrd">As</span> <span class="kwrd">Double</span>)</pre><pre>
    MsgBox(<span class="kwrd">CInt</span>(n))</pre><pre class="alt"><span class="kwrd">End</span> Sub</pre></div><p /><style type="text/css"><![CDATA[

.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style><p> </p><p>C#</p><div class="csharpcode"><pre class="alt"><span class="kwrd">private</span> <span class="kwrd">void</span> ShowDoubleToInt(<span class="kwrd">double</span> n)</pre><pre>
{</pre><pre class="alt">
    MessageBox .Show (Convert .ToInt32 (n).ToString ());</pre><pre>
}</pre></div><p /><style type="text/css"><![CDATA[

.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style><p> </p><p>雖然.NET在轉換上預設使用了『四捨六入五成雙』的方式，但不表示我們就不能使用『四捨五入』的方式。.NET仍很貼心的為我們準備了許多函式可以做『四捨五入』，像是Round()、ToString()...等，若有需求可自行參考藍色小舖討論串。</p><p> </p><p>值得注意的是，在C#中有兩種不同的轉換方式，其所使用的進位方式並不相同，這也是上面C#範例會使用System.Convert的原因，使用上須特別注意。</p><div class="csharpcode"><pre class="alt">
Console.WriteLine(((<span class="kwrd">int</span>)numericUpDown1 .Value).ToString ());   <span class="rem">//無條件捨去</span></pre><pre>
Console.WriteLine(Convert .ToInt32 (numericUpDown1.Value).ToString());   //四捨六入五成雙</pre></div><p /><style type="text/css"><![CDATA[
.csharpcode, .csharpcode pre
{
	font-size: small;
	color: black;
	font-family: consolas, "Courier New", courier, monospace;
	background-color: #ffffff;
	/*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
	background-color: #f4f4f4;
	width: 100%;
	margin: 0em;
}
.csharpcode .lnum { color: #606060; }]]></style><p> </p><h2>參考資料</h2><ol><li>程式設計俱樂部 - System.Convert 為何是五捨六入?</a></li><li><a target="_blank" href="http://www.blueshop.com.tw/board/show.asp?subcde=BRD200511221010158DG&amp;fumcde=FUM20050124192253INM">藍色小鋪 - C#沒有四捨五入？只有五捨六入的涵數？</li></ol>