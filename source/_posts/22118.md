---
layout: post
title: "土豆視頻開發系列-依影集分類查詢"
date: 2011-03-27 10:53:19
comments: true
tags: [C#]
description: "土豆視頻開發系列-依影集分類查詢"
---
<p>
	要從土豆往上截取影集資料，我們可先參閱頻道劇集查詢，該API的URL位置會像下面這樣：</p>
<p>
	http://api.tudou.com/v3/gw?method=album.channel.get&amp;appKey=&amp;format=&amp;channel=&amp;pageNo=&amp;pageSize=</p>
<p>
	 </p>
<p>
	除了appKey與format這兩個API所通用的參數外，另外又含有channel、pagegNo、pageSize這三個參數，channel部份可帶入的有m、t、z三個，分別代表的是電影、電視、與綜藝，而pageNo與pageSize用以指定想要截取的頁數與資料量。</p>
<p>
	 </p>
<p>
	使用上就像是下面這樣：</p>
<p>
	http://api.tudou.com/v3/gw?method=album.channel.get&amp;appKey=myKey&amp;format=xml&amp;channel=z&amp;pageNo=1&amp;pageSize=10</p>
<p>
	 </p>
<p>
	API會依照指定的指定的格釋回傳所查詢的資料，因這邊示範的是XML所以會以XML的形式呈現。</p>
<p>
	<img alt="image" border="0" height="566" src="\images\posts\22118\image_thumb_5.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="622" /></p>
<p>
	 </p>
<p>
	其資料所對應的欄位可查閱劇集字段定義。</p>
<p>
	<img alt="image" border="0" height="394" src="\images\posts\22118\image_thumb_1.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="644" /></p>
<p>
	 </p>
<p>
	範例程式如下：</p>
<pre>
private void SetTudouAlbumContent()
{
    UnBindingEvent();
    var channels=new string[]{"m","t","z"};
    var url = string.Format(ALBUM_URL_PATTERN, textBox1.Text, channels[cbxChannel.SelectedIndex], (cbxPage.SelectedIndex &lt; 0) ? 1 : cbxPage.SelectedIndex + 1, 10);
    string xml = GetHTMLSourceCode(url);
    XmlDocument xmlDom = new XmlDocument();
    xmlDom.LoadXml (xml);
 
    XmlNodeList nodes = xmlDom.SelectNodes(@"/result/results/AlbumInfo");           
    foreach (XmlNode node in nodes)
    {
        // Name = node.ChildNodes[1].InnerText
        // picUrl = node.ChildNodes[2].InnerText
        // ...
        ...
    }
    ...
}</pre>
<p>
	 </p>
<p>
	透過上面的程式已經可以取得影集的資料，若要進一步取得影集中的節目資訊，需參閱劇集節目查詢，該API的URL位置會像下面這樣：</p>
<p>
	http://api.tudou.com/v3/gw?method=album.item.get&amp;appKey=&amp;format=&amp;albumId=&amp;pageNo=&amp;pageSize=</p>
<p>
	 </p>
<p>
	該道API的參數跟上面大同小異，這邊不作重複的敘述，不同的是albumId這個參數，我們可將上面取得的albumid帶入，像是下面這樣：</p>
<p>
	http://api.tudou.com/v3/gw?method=album.item.get&amp;appKey=myKey&amp;format=xml&amp;albumId=50815&amp;pageNo=1&amp;pageSize=10</p>
<p>
	 </p>
<p>
	叫用後會取得如下XML資料：</p>
<p>
	<img alt="image" border="0" height="566" src="\images\posts\22118\image_thumb_6.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="622" /></p>
<p>
	 </p>
<p>
	其資料所對應的欄位可查閱視頻字段定義。</p>
<p>
	<img alt="image" border="0" height="324" src="\images\posts\22118\image_thumb_3.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="644" /></p>
<p>
	 </p>
<p>
	這邊做了ㄧ個範例程式，將上面的API做了較為完整的示範，可查閱電視、電影、綜藝這三種不同類型的影片，可指定查閱的頁數，以及透過網頁做簡易的播放。</p>
<p>
	<img alt="image" border="0" height="478" src="\images\posts\22118\image_thumb_7.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="450" /></p>
<p>
	<img alt="image" border="0" height="478" src="\images\posts\22118\image_thumb_8.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="450" /></p>
<p>
	 <img alt="image" border="0" height="487" src="\images\posts\22118\image_thumb_9.png" style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" width="510" /></p>
<p>
	 </p>
<h2>
	Download</h2>
<p>
	TudouDemo.rar</p>
<p>
	 </p>
<h2>
	Link</h2>
<ul>
	<li>
		頻道劇集查詢</li>
	<li>
		劇集字段定義</li>
	<li>
		劇集節目查詢</li>
	<li>
		視頻字段定義</li>
</ul>
