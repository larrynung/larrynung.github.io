---
layout: post
title: "[C#][VB.NET].NET捷徑(ShortCut)控制"
date: 2008-11-02 01:53:03
comments: true
tags: [CSharp,VB.NET]
description: "[C#][VB.NET].NET捷徑(ShortCut)控制"
---
<h2>Abstract</h2><ul><li>Component</li><li>ShortCut Type</li><li>Control Method</li><li>Text Edit Control Method</li><li>Windows Script Host Method Control Method</li><li>Shell.Application Control Method</li><li>Reference</li><li>Download</li></ul><p> </p><h2>Component</h2><p>一般來說，ShortCut主要是由下面幾個元素所構成：</p><ol><li>Target</li><li>Working directory</li><li>HotKey</li><li>Running style</li><li>Description</li><li>Icon</li></ol><p>  <font color="#000000"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" width="371" height="477" src="\images\posts\5847\image_thumb_3.png" /></font></a></p><p> </p><h2>ShortCut Type</h2><ol><li><strong>Url ShortCut</strong>-Like browser 's shortcut,which extention file name is "url".</li><li><strong>Application ShortCut</strong>-Normal application shortcut,which extention file name is "lnk".</li></ol><p> </p><p> </p><h2>Control Method</h2><ol><li><strong>Text Edit</strong>-Use to control the shortcut like browser use for.</li><li><strong>Windows Script Host (WSH)</strong></li><li><strong>Shell.Application</strong></li><li><strong>API</strong></li></ol><p> </p><h2>Text Edit Control Method</h2><p>依照下圖格式範本建立副檔名為"url"的文字檔即可，這類型的捷徑控制只是一般的文字檔處理。</p><p><a href="http://files.dotblogs.com.tw/larrynung/0811/ShortCut_A9A/image_6.png"><font color="#000000"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" width="573" height="234" src="\images\posts\5847\image_thumb_1.png" /></font></a></p><p> </p><p>若是要造Application類型的捷徑，則如下圖把"URL=http://..." 改成"URL=file:///..."即可。</p><p><a href="http://files.dotblogs.com.tw/larrynung/0811/ShortCut_A9A/image_8.png"><font color="#000000"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" width="572" height="233" src="\images\posts\5847\image_thumb_2.png" /></font></a></p><p> </p><p>範例程式可參考 <a target="_blank" href="http://www.sorrowman.org/c-sharp-programmer/url-link-to-desktop.html"><font color="#000000">C# - Creating URL shortcut to desktop</font> 。當然你也可以不使用該範例的方法，而改透過Win32 Api去用存取Ini檔的方式來控制此種捷徑格式。</p><p> </p><p> </p><p> </p><h2>Windows Script Host Method Control Method</h2><p>對於VB.NET的開發員來說。欲使用WSH，首先要利用CreateObject("WScript.Shell")建造WshShell物件。</p><p> </p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:9ef8532f-49a3-47ac-81b1-bb1917ce61d8" class="wlWriterSmartContent"><pre class="vb" name="code">
Dim objWS As Object = CreateObject("WScript.Shell")</pre></div><p> </p><p> </p><p> </p><p>接著使用WshShell物件的CreateShortCut回傳的物件及其方法、屬性去控制捷徑。以建造捷徑為例，只要用CreateShortCut取得物件後，把要設定的值設定給對應的屬性後，呼叫該物件的Save方法即可。</p><p> </p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:42f3b654-1414-4290-bb10-7fbf883fed10" class="wlWriterSmartContent"><pre class="vb" name="code">
With objWS.CreateShortCut(Environment.GetFolderPath(Environment.SpecialFolder.Desktop) &amp; "\" &amp; Replace(strEXE, ".EXE", ".LNK", 1, , 1))
    .TargetPath = objWS.ExpandEnvironmentStrings(strFolder &amp; "\" &amp; strEXE)
    .WorkingDirectory = strFolder
    .Description = strDesc
    .WindowStyle = 4
    .IconLocation = objWS.ExpandEnvironmentStrings(strFolder &amp; "\" &amp; strEXE &amp; ",0")
    .Save()
End With</pre></div><p> </p><p> </p><p> </p><p>值得一提的是，雖然該WshShell物件的方法名稱為CreateShortCut。但是並不表示它只能用來建立捷徑，它也能用來讀取捷徑的設定。讀取時先用CreateShortCut取得物件後，直接從該物件對應的屬性去取出設定即可。</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:45b65605-f8b0-48c9-839a-d2275c19a2e6" class="wlWriterSmartContent"><pre class="vb" name="code">
With objWS.CreateShortCut(lnkFile)
    Return .TargetPath
End With</pre></div><p> </p><p> </p><p> </p><p>P.S.C#的開發員請參考 [C#]用2种方法创建快捷方式.(Visual Studio .Net 2005)</a></p><p> </p><h2>Shell.Application Control Method</h2><p>欲使用此方法控制捷徑，如下圖所示，首先要加入Com參考"Microsoft Shell Controls And Automation"。</p><p><a href="http://files.dotblogs.com.tw/larrynung/0811/ShortCut_A9A/image_2.png"><font color="#000000"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" width="506" height="368" src="\images\posts\5847\image_thumb.png" /></font></p><p> </p><p>加入參考後匯入Shell32命名空間，建立Shell物件實體，並利用Shell物件實體方法帶入檔案路徑與檔名去取得ShellLinkObject物件。</p><p>VB.NET</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:edf61399-ae8d-4b6b-a781-3c2ef0872b28" class="wlWriterSmartContent"><pre class="vb" name="code">
Dim s As New Shell
Return s.NameSpace(My.Computer.FileSystem.GetParentPath(file)).ParseName(My.Computer.FileSystem.GetName(file)).GetLink</pre></div><p> </p><p>C#</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:cda1d913-8488-4a8a-b75f-4e2234eb4fc4" class="wlWriterSmartContent"><pre class="c#" name="code">
Shell s = new Shell();
return (ShellLinkObject)s.NameSpace(Path.GetDirectoryName(lnkFile)).ParseName(Path.GetFileName(lnkFile)).GetLink;</pre></div><p> </p><p>再透過ShellLinkObject物件的屬性與方法即可對捷徑進行控制。</p><p>VB.NET</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:b9b9e6d8-5342-4eb9-b3c6-47ea0a2b195a" class="wlWriterSmartContent"><pre class="vb" name="code">
Function GetLnkArguments(ByVal shortCutFile As String) As String
    Return GetLnkObj(shortCutFile).Arguments
End Function

Function GetLnkWorkingDirectory(ByVal shortCutFile As String) As String
    Return GetLnkObj(shortCutFile).WorkingDirectory
End Function

Function GetLnkPath(ByVal shortCutFile As String) As String
    Return GetLnkObj(shortCutFile).Path
End Function
</pre></div><p> </p><p>C#</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:176347d2-33ab-489b-b1f3-3f9341269ccf" class="wlWriterSmartContent"><pre class="c#" name="code">
private String GetLnkArguments(string shortCutFile)
{
    return GetLnkObj(shortCutFile).Arguments;
}

private String GetLnkWorkingDirectory(string shortCutFile)
{
    return GetLnkObj(shortCutFile).WorkingDirectory;
}

private String GetLnkPath(string shortCutFile)
{
    return GetLnkObj(shortCutFile).Path;
}</pre></div><p> </p><p> </p><p>這邊須注意的是，使用此方法建立捷徑時，若捷徑檔不存在於指定位置，則須先建立個空的捷徑檔案，才可取得ShellLinkObject物件。</p><p>VB.NET</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:9aa00169-d75f-43cf-bb07-a5a70f18e959" class="wlWriterSmartContent"><pre class="vb" name="code">
If Not My.Computer.FileSystem.FileExists(shortCutFile) Then
    File.Create(shortCutFile).Close()
End If</pre></div><p> </p><p>C#</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:4c27cf5b-37d9-47d5-8cd5-03ac3aefe9a6" class="wlWriterSmartContent"><pre class="c#" name="code">
if (!My.Computer.FileSystem.FileExists(shortCutFile))
{
    File.Create(shortCutFile).Close();
}</pre></div><p> </p><p> </p><p>取得ShellLinkObject物件後，捷徑的建立與寫入也就只是設定對應的屬性值後呼叫Save方法。</p><p>VB.NET</p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:d78477df-efcb-4ba3-8f65-2a3f0f6cb22e" class="wlWriterSmartContent"><pre class="vb" name="code">
lnkObj = GetLnkObj(shortCutFile)
With lnkObj
    .Arguments = arguments
    .Description = description
    .Path = path
    .WorkingDirectory = workingDirectory
    .ShowCommand = showCommand
    .Save()
End With</pre></div><p> </p><p>C#</p><p> </p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:89ee4a5a-0877-4a6e-a74e-505a85b22862" class="wlWriterSmartContent"><pre class="c#" name="code">
lnkObj = GetLnkObj(shortCutFile);
lnkObj.Arguments = arguments;
lnkObj.Description = description;
lnkObj.Path = path;
lnkObj.WorkingDirectory = workingDirectory;
lnkObj.ShowCommand = (int)showCommand;
lnkObj.Save(null);
</pre></div><p> </p><p> </p><div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" class="wlWriterSmartContent"><h2>Reference</h2></div><p> </p><ol><li><font color="#000000">C# - Creating URL shortcut to desktop</font></a></li><li><a target="_blank" href="http://forums.microsoft.com/MSDN-CHT/ShowPost.aspx?PostID=713548&amp;SiteID=14"><font color="#000000">微軟技術社群討論區-請問如何建立桌面捷徑和網頁捷徑?</font></a></li><li><a target="_blank" href="http://blog.blueshop.com.tw/HammerChou/archive/2006/06/18/29111.aspx"><font color="#000000">強力鎯頭 の VB 部落-如何寫程式建立桌面捷徑 ( Shortcut )</font></a></li><li><a target="_blank" href="http://www.codeproject.com/KB/dotnet/shelllink.aspx"><font color="#000000">Code Project-Creating Shell Links (Shortcuts) in .NET Programs Using WSH</font></a></li><li><a target="_blank" href="http://www.chinadforce.com/viewthread.php?tid=941624&amp;highlight=">[C#]用2种方法创建快捷方式.(Visual Studio .Net 2005)</a></li></ol><p> </p><h2>Download</h2><p> <a href="http://Files.Dotblogs.com.tw/larrynung/0901/200912612193547.rar">ShortCut.rar</p>