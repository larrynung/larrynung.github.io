---
layout: post
title: "[C#]使用Win32 API為編輯框與下拉方塊加上提示字串"
date: 2010-07-08 11:03:48
comments: true
tags: [C#]
description: "[C#]使用Win32 API為編輯框與下拉方塊加上提示字串"
---
<p>Windows在XP與2003開始對單行編輯框支援顯示提示字串的功能，在Vista與2008以後下拉方塊也開始有了支援，多半這樣的功能被用在搜尋框上。像是Windows Live Mail、Windows 7等的搜尋框就是很好的例子。</p> <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="\images\posts\16460\image_thumb.png" width="257" height="33" /></a> </p> <p><a href="http://files.dotblogs.com.tw/larrynung/1007/4a029774e1b5_133D2/image_6.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="\images\posts\16460\image_thumb_2.png" width="265" height="58" /> </p> <p> </p> <h2>為編輯框加上提示字串</h2> <p>要為編輯框加上提示字串，首先我們必須先了解EM_SETCUEBANNER訊息，該訊息是用來設定編輯框要用來顯示的提示字串，其隨之帶入SendMessage的兩個參數wParam與lParam分別簡述如下：</p> <p><strong><em>WParam</em></strong></p> <p>當編輯框獲得焦點時是否顯示提示字串 <br />True=&gt;當編輯框獲得焦點仍舊顯示提示字串 <br />False=&gt;當編輯框獲得焦點時提示字串就消失</p> <dt> </dt><p> </p> <dt><em><strong>lParam</strong></em>  </dt><p>要顯示的提示字串</p> <p> </p> <p>對EM_SETCUEBANNER訊息的用法有了了解之後，使用SendMessage對編輯框發送EM_SETCUEBANNER訊息，並帶入對應的參數就可以了。就像下面這樣：</p> <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:a9982e20-3f0f-45e3-8776-28498e108749" class="wlWriterEditableSmartContent"><pre name="code" class="c#">[DllImport("user32.dll", CharSet = CharSet.Auto)]
private static extern Int32 SendMessage(IntPtr hWnd, int msg, int wParam, [MarshalAs(UnmanagedType.LPWStr)] string lParam);
...
const int EM_SETCUEBANNER = 0x1501;
...
SendMessage(this.Handle, EM_SETCUEBANNER, 0, "提示字串");</pre></div>
<p> </p>
<p>也可以整理成控制項重複使用：</p>
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:573cc0f1-939c-4237-8783-44f3af7a34e3" class="wlWriterEditableSmartContent"><pre name="code" class="c#">    public class CueTextBox : TextBox
    {
        [DllImport("user32.dll", CharSet = CharSet.Auto)]
        private static extern Int32 SendMessage(IntPtr hWnd, int msg, int wParam, [MarshalAs(UnmanagedType.LPWStr)] string lParam);

        const int EM_SETCUEBANNER = 0x1501;

        private string _cueText;

        [Localizable(true)]
        public string CueText
        {
            get
            {
                if (_cueText == null)
                    return string.Empty;
                return _cueText;
            }
            set
            {
                _cueText = value;
                updateCue();
            }
        }

        private void updateCue()
        {
            SendMessage(this.Handle, EM_SETCUEBANNER, 0, CueText);
        }
    }</pre></div>
<p> </p>
<p>使用上只要放至表單，接著設置CueText屬性就可以了。</p>
<p> <img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="\images\posts\16460\image_thumb_1.png" width="196" height="96" /> </p>
<p> </p>
<h2>為下拉方塊加入提示字串</h2>
<p>要為下拉方塊加上提示字串，首先我們必須先了解CB_SETCUEBANNER訊息，該訊息是用來設定下拉方塊要用來顯示的提示字串，其隨之帶入SendMessage的兩個參數wParam與lParam分別簡述如下：</p><pre><em><strong>wParam</strong></em></pre><pre>必須為0</pre><pre> </pre>
<dt><em><strong>lParam</strong></em></dt>
<p>要顯示的提示字串</p>
<p> </p>
<p>使用上一樣只要對下拉方塊發送CB_SETCUEBANNER訊息就可以了：</p>
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:58001152-c091-47b9-be97-45feaa99691b" class="wlWriterEditableSmartContent"><pre name="code" class="c#">[DllImport("user32.dll", CharSet = CharSet.Auto)]
private static extern Int32 SendMessage(IntPtr hWnd, int msg, int wParam, [MarshalAs(UnmanagedType.LPWStr)] string lParam);
...
const int CB_SETCUEBANNER = 0x1703;
...
SendMessage(this.Handle, CB_SETCUEBANNER0, "提示字串");</pre></div>
<p> </p>
<h2>Link</h2>
<ul>
<li>Search box 
</li><li>Is there a way to do default text with a WinForms textbox? 
</li><li>EM_SETCUEBANNER Message 
</li><li>CB_SETCUEBANNER Message
</li><li>The Missing .NET #1: Cue Banners in Windows Forms (EM_SETCUEBANNER, Text Prompt) 
</li><li>[VB.NET]设置TextBox的提示文字 </li></ul>