---
layout: post
title: "FlickrNet開發系列 - FlickrNet開發前準備與登入驗證機制的實現"
date: 2011-04-23 11:50:39
comments: true
tags: [CSharp]
description: "FlickrNet開發系列 - FlickrNet開發前準備與登入驗證機制的實現"
---
<p>使用FlickrNet開發Flickr服務程式，需先至Flickr.Net API Library</a>網站下載開發用的組件包。</p>  <p><a href="http://files.dotblogs.com.tw/larrynung/1104/Flickr_14B97/image_4.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\23404\image_thumb_1.png" width="522" height="517" /></a></p>  <p> </p>  <p>下載玩開發用組件包後，解壓縮會看到許多組件，從組件的檔名可以很清楚的知道所支援的平台，有一般Windows Form開發用的、行動裝置開發用的、Silverlight開發用的、與Windows Phone 7開發用的，這邊請依自己的開發需求將對應的組件加入參考。</p>  <p><a href="http://files.dotblogs.com.tw/larrynung/1104/Flickr_14B97/image_6.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\23404\image_thumb_2.png" width="566" height="457" /></a></p>  <p><a href="http://files.dotblogs.com.tw/larrynung/1104/Flickr_14B97/image_8.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\23404\image_thumb_3.png" width="521" height="399" /></a></p>  <p> </p>  <p>加入參考後需加入FlickrNet命名空間</p>  <p>using FlickrNet;</p>  <p> </p>  <p>在開發時，最主要要使用的類別就是Flickr，其建構函式有四個多載版本：</p>  <p>public Flickr()   <br />public Flickr(string apiKey)    <br />public Flickr(string apiKey, string sharedSecret)    <br />public Flickr(string apiKey, string sharedSecret, string token)</p>  <p> </p>  <p>可以看到建構Flickr時要帶入的不外乎就是apiKey、secret、與token。apiKey與secret可參閱<a href="http://www.dotblogs.com.tw/larrynung/archive/2011/04/09/22384.aspx">Flickr開發系列 - 應用程式與API Key的申請</a>這篇取得，多半的動作我們只需要戴入apiKey與secret，當有進階的處理動作才須帶入token。</p>  <p> </p>  <p>以開發的流程來看，首先我們必須將flickr物件建立起來</p>  <p>var flickr = new Flickr(apiKey, secret);</p>  <p> </p>  <p>建立起來後透過Flickr.AuthGetFrob取得Frob</p>  <p>var frob = flickr.AuthGetFrob();</p>  <p> </p>  <p>透過Flickr.AuthCalcUrl函式，帶入剛產生的Frob與所要跟使用者要求的權限，產出登入所需要用到的網址。這邊要求的權限是透過FlickrNet.AuthLevel列舉指定，可依自己程式的需求決定所需的權限。</p>  <p>string url = flickr.AuthCalcUrl(frob, FlickrNet.AuthLevel.Read | FlickrNet.AuthLevel.Write);</p>  <p> </p>  <p>將產出的登入網址帶入瀏覽器，讓使用者做登入與授權動作</p>  <p>Form loginDlg = new Form();   <br />loginDlg.Text = "Login";    <br />loginDlg.Width = 500;    <br />loginDlg.Height = 600;    <br />loginDlg.StartPosition = FormStartPosition.CenterScreen;</p>  <p>WebBrowser browser = new WebBrowser();   <br />browser.Navigate(url);    <br />browser.Dock = DockStyle.Fill;</p>  <p>loginDlg.Controls.Add(browser);   <br />loginDlg.ShowDialog();</p>  <p> </p>  <p><a href="http://files.dotblogs.com.tw/larrynung/1104/Flickr_14B97/image_10.png"><img style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" border="0" alt="image" src="\images\posts\23404\image_thumb.png" width="463" height="550" /></a> </p>  <p><a href="http://files.dotblogs.com.tw/larrynung/1104/Flickr_14B97/image_12.png"><img style="border-bottom: 0px; border-left: 0px; border-top: 0px; border-right: 0px" border="0" alt="image" src="\images\posts\23404\image_thumb_4.png" width="463" height="550" /></a> </p>  <p> </p>  <p>登入與授權動作完成後，透過Flickr.AuthGetToken函式帶入Frob取得Auth。</p>  <p>Auth auth = flickr.AuthGetToken(frob);</p>  <p> </p>  <p>取得的Auth內會含一開始所提到的Token資訊，要將其塞回Flickr.AuthToken，如此才能操作一些進階的動作。</p>  <p>flickr.AuthToken = auth.Token;</p>  <p> </p>  <p>要注意的是，若開發的服務程式需要做到登入驗證後，下次開啟會自動登入驗證的話，須將上面認證的Token記錄下來，將紀錄的Token透過Flickr.AuthCheckToken將認證資訊取回，取回後再塞回Flickr.AuthToken。</p>  <p>auth = flickr.AuthCheckToken(token);</p>  <p>flickr.AuthToken = auth.Token;</p>  <p> </p>  <h2>Link</h2>  <ul>   <li><a href="http://flickrnet.codeplex.com/" target="_blank">Flickr.Net API Library</a> </li>    <li><a href="http://www.dotblogs.com.tw/laneser/archive/2009/07/19/9579.aspx" target="_blank">[Windows Mobile .NET CF] 拍照上傳 Flickr – Day2</a> </li>    <li><a href="http://programer.blog.richiestyle.org/2006/12/flickrnet_05.html" target="_blank">用 Flickr.NET 來上傳照片的開發步驟 </li> </ul>