---
layout: post
title: "[C#]Effective C# 條款五： 總是提供ToString方法"
date: 2009-10-13 09:05:31
comments: true
categories: [C#]
description: "[C#]Effective C# 條款五： 總是提供ToString方法"
---
<p>
	ToString方法昰.NET程式中最常用的方法。除了開發人員直接叫用外，.NET程式在某些情況下也會隱含叫用該方法。</p>
<p>
	在未做覆寫處理的狀態下，我們呼叫ToString方法時，系統會直接叫用Systrm.Object類別的ToString方法。因此每當我們叫用，返回值多半是類別名稱，像是"System.Object"、"System.Data.DataSet"等較不具識別性的字串。而這樣的字串也多半不是我們想顯示給客戶的，但如果我們不覆寫Object的ToString方法，客戶看到的就將會是這些。</p>
<p>
	 </p>
<p>
	讓我們先來看個簡單的例子：</p>
<div class="wlWriterEditableSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:92ca8e29-95ef-4d9a-8411-88601c530d29" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
	<pre class="c#:nocontrols" name="code">
	class Program
    {
        static void Main(string[] args)
        {
            Customer larry=new Customer(){Name="larry"};
            Console.WriteLine(larry);
        }
    }

    public class Customer
    {
        public string Name { get; set; }
        public Decimal Revenue { get; set; }
        public string ContactPhone { get; set; }
    }</pre>
</div>
<p>
	 </p>
<p>
	 </p>
<p>
	運行結果<br />
	<img alt="image" border="0" height="191" src="\images\posts\11033\image_thumb.png" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="497" /></p>
<p>
	 </p>
<p>
	若我們適當的覆寫類別的ToString方法，為類別提供自訂的顯示資訊：</p>
<div class="wlWriterEditableSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:75c78a7a-4bd9-40ae-8f90-ec02dfa38c2e" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
	<pre class="c#:nocontrols" name="code">
	class Program
    {
        static void Main(string[] args)
        {
            Customer larry = new Customer() { Name = "larry"};
            Console.WriteLine(larry);
        }
    }

    public class Customer
    {
        public string Name { get; set; }
        public Decimal Revenue { get; set; }
        public string ContactPhone { get; set; }

        public override string ToString()
        {
            return string.Format("Customer{{Name = {0}, Revenue = {1}, ContactPhone = {2}}}",Name,Revenue.ToString (),ContactPhone);
        }
    }</pre>
</div>
<p>
	 </p>
<p>
	 </p>
<p>
	 </p>
<p>
	 </p>
<p>
	 </p>
<p>
	運行後我們可以發現顯示上將變得較具識別性與意義。<br />
	<img alt="image" border="0" height="159" src="\images\posts\11033\image_thumb_1.png" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="529" /></p>
<p>
	 </p>
<p>
	除此之外，在.NET程式中，很多地方都具有隱含叫用ToString的機制。像是Console.WriteLine、String.Format等傳遞Object物件來設定與顯示字串的方法。</p>
<div class="wlWriterEditableSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:b64ac65d-929a-4bd9-adf4-409b613b3f2f" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
	<pre class="c#:nocontrols" name="code">
	Console.WriteLine(larry.ToString ());
            Console.WriteLine(larry);
            Console.WriteLine (String.Format("{0}", larry));</pre>
</div>
<p>
	 </p>
<p>
	 </p>
<p>
	 </p>
<p>
	<img alt="image" border="0" height="159" src="\images\posts\11033\image_thumb_4.png" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="577" /></p>
<p>
	 </p>
<p>
	甚至是ㄧ些介面的控制項元件也都會隱含叫用ToString。像是ListBox</p>
<div class="wlWriterEditableSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:3eec2b6a-a28f-47c7-8fd4-5850e4b88773" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
	<pre class="c#:nocontrols" name="code">
	public partial class Form1 : Form
    {
        List&lt;Customer&gt; _Customers = new List&lt;Customer&gt;() { new Customer{Name = "larry"}};
        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            this.listBox1.DataSource = _Customers;
        }
    }
    public class Customer
    {
        public string Name { get; set; }
        public Decimal Revenue { get; set; }
        public string ContactPhone { get; set; }

        public override string ToString()
        {
            return string.Format("Customer{{Name = {0}, Revenue = {1}, ContactPhone = {2}}}", Name, Revenue.ToString(), ContactPhone);
        }
    }</pre>
</div>
<p>
	 </p>
<p>
	 </p>
<p>
	<img alt="image" border="0" height="244" src="\images\posts\11033\image_thumb_2.png" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="244" /></p>
<p>
	 </p>
<p>
	或是ComboBox等</p>
<div class="wlWriterEditableSmartContent" id="scid:812469c5-0cb0-4c63-8c15-c81123a09de7:de583be6-3417-4be6-a8f4-c6c1e9cc7bb1" style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px">
	<pre class="c#:nocontrols" name="code">
	public partial class Form1 : Form
    {
        List&lt;Customer&gt; _Customers = new List&lt;Customer&gt;() { new Customer{Name = "larry"}};
        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            this.comboBox1.DataSource = _Customers;
        }
    }
    public class Customer
    {
        public string Name { get; set; }
        public Decimal Revenue { get; set; }
        public string ContactPhone { get; set; }

        public override string ToString()
        {
            return string.Format("Customer{{Name = {0}, Revenue = {1}, ContactPhone = {2}}}", Name, Revenue.ToString(), ContactPhone);
        }
    }</pre>
</div>
<p>
	 </p>
<p>
	<img alt="image" border="0" height="62" src="\images\posts\11033\image_thumb_3.png" style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" width="326" /></p>
<p>
	 </p>
<p>
	 </p>
<p>
	 </p>
<p>
	因此為類別提供適當的ToString方法，不僅有助於使用者辯識。對於開發員來說，在清楚掌握了隱含叫用ToString的機制後，使用覆寫過ToString方法的類別時，也將獲得不少的便利。</p>
<p>
	 </p>
<p>
	透過覆寫來撰寫簡單的ToString方法，在大多數的情況下，已經可以滿足我們的需求，但有時候我們會需要功能更強的方法。此時我們可以透過實做IFormattable介面，為類別提供可帶入輸出格式的ToString方法。這邊該介面的實作方法暫且不做介紹，請先自行參考MSDN的IFormattable介面。後續有空將會再回頭補上。</p>
