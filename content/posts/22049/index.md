---
title: "[C#]取得檔案對應的MIME Content Type"
date: "2011-03-24 01:12:45"
description: "[C#]取得檔案對應的MIME Content Type"
tags: [CSharp]
---

<p>在寫Youtube的上傳時，在設定上傳的資訊中有一項是Content Type，該屬性是字串型態，且未提供我們列舉直接選取或是自動由檔案名稱判別的功能，在這邊被卡關了許久，最後下才發現這邊的Content Type指的是MIME Content Type。而要取得檔案對應的MIME Content Type，其實並不困難，因為這樣的資訊都已經存在登錄檔中了，我們可以從登錄檔中的資訊下手，只要會用程式擷取出登錄檔資訊就可以取得檔案對應的MIME Content Type。</p>  <p> </p>  <p>MIME Content Type資訊存放在登錄檔中的HKEY_CLASSES_ROOT\[副檔名]\Content Type下</p>  <p><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\22049\image_thumb_1.png" width="549" height="435" /></a> </p>  <p> </p>  <p>因此由指定檔案的附檔名可以找到HKEY_CLASSES_ROOT下對應的機碼，再取得機碼下的Content Type值就可以了：</p>  <p>private static string GetContentTypeForFileName(string fileName)   <br />{    <br />    string ext = System.IO.Path.GetExtension(fileName);    <br />    using (Microsoft.Win32.RegistryKey registryKey = Microsoft.Win32.Registry.ClassesRoot.OpenSubKey(ext))    <br />    {    <br />        if (registryKey == null)    <br />            return null;    <br />        var value = registryKey.GetValue("Content Type");    <br />        return (value == null) ? string.Empty : value.ToString();    <br />    }    <br />}  </p>  <p />  <p> </p>  <p>完整範例如下：</p>  <p>using System;   <br />using System.Collections.Generic;    <br />using System.Linq;    <br />using System.Text;    <br />namespace ConsoleApplication10    <br />{    <br />    class Program    <br />    {    <br />        static void Main(string[] args)    <br />        {    <br />            const string file = @"C:\Users\Public\Music\Sample Music\Sleep Away.mp3";    <br />            Console.WriteLine(GetContentTypeForFileName(file));    <br />        }    <br />        private static string GetContentTypeForFileName(string fileName)    <br />        {    <br />            string ext = System.IO.Path.GetExtension(fileName);    <br />            using (Microsoft.Win32.RegistryKey registryKey = Microsoft.Win32.Registry.ClassesRoot.OpenSubKey(ext))    <br />            {    <br />                if (registryKey == null)    <br />                    return null;    <br />                var value = registryKey.GetValue("Content Type");    <br />                return (value == null) ? string.Empty : value.ToString();    <br />            }    <br />        }    }    <br />}</p>  <p> </p>  <p>運行結果：</p>  <p><a href="http://files.dotblogs.com.tw/larrynung/1103/CMIMEContentType_B4AF/image_2.png"><img style="border-right-width: 0px; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" border="0" alt="image" src="\images\posts\22049\image_thumb.png" width="353" height="175" /></a> </p>  <p> </p>  <h2>Link</h2>  <ul>   <li><a href="http://zh.wikipedia.org/wiki/MIME" target="_blank">MIME</a> </li>    <li><a href="http://www.w3schools.com/media/media_mimeref.asp" target="_blank">MIME Reference </li> </ul>
